kind: ZarfPackageConfig
metadata:
  name: component-actions-edgecases
  description: Component actions edge cases

variables:
  - name: AVAILABLE_REPLICAS
    default: "1"

values:
  files:
    - values.yaml

components:
  - name: on-deploy
    required: true
    actions:
      onDeploy:
        before:
          # Wait for something that doesn't have a namespace (no -n)
          - wait:
              cluster:
                kind: ns
                name: zarf
          # Ensure variables work during wait
          - wait:
              cluster:
                kind: deployment
                name: "zarf-docker-registry"
                namespace: "zarf"
                condition: "'{.status.availableReplicas}'=${ZARF_VAR_AVAILABLE_REPLICAS}"
          - wait:
              cluster:
                kind: deployment
                name: "zarf-docker-registry"
                namespace: "zarf"
                condition: "'{.status.availableReplicas}'=$ZARF_VAR_AVAILABLE_REPLICAS"
          # Ensure values work during wait
          - wait:
              cluster:
                kind: deployment
                name: "zarf-docker-registry"
                namespace: "zarf"
                condition: "'{.status.availableReplicas}'={{ .Values.availableReplicas }}"
            template: true
