kind: ZarfPackageConfig
metadata:
  name: test-values
  description: Minimal test package for values feature

values:
  files:
    - values/values.yaml

components:
  - name: test-values-component
    required: true
    actions:
      onDeploy:
        before:
          - cmd: echo '{"myKey":"myValue"}'
            setValues:
              - key: .json
                type: json
          - cmd: >
              echo 'myKey: myValue'
            setValues:
              - key: .yaml
                type: yaml
          # Test that template: false (or omitted, since false is default) prevents Zarf from processing go-templates
          - cmd: echo 'template={{ .shouldNotBeProcessed }}'
            setValues:
              - key: .rawTemplate
                type: string
          # Test that template: true enables Zarf go-template processing
          - cmd: echo 'processed={{ .Values.json.myKey }}'
            template: true
            setValues:
              - key: .processedTemplate
                type: string
      onRemove:
        before:
          - cmd: echo "REMOVE_TEST_VALUE={{ .Values.test }}"
            template: true
          - cmd: echo "REMOVE_CUSTOM_VALUE={{ .Values.removeKey }}"
            template: true
    manifests:
      - name: test-configmap
        template: true
        files:
          - configmap.yaml
      - name: test-action-configmap
        template: true
        files:
          - action-configmap.yaml
      - name: test-raw-template-configmap
        template: true
        files:
          - raw-template-configmap.yaml
      - name: test-processed-template-configmap
        template: true
        files:
          - processed-template-configmap.yaml
